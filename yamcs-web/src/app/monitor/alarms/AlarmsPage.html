<app-monitor-page *ngIf="instance$ | async as instance">
  <app-monitor-toolbar>Alarms</app-monitor-toolbar>

  <div class="panel-content">
    <mat-table *ngIf="dataSource.data.length; else empty"
               [dataSource]="dataSource"
               [trackBy]="tableTrackerFn"
               class="ya-data-table"
               matSort
               matSortActive="parameter"
               matSortDirection="asc"
               matSortDisableClear>

      <ng-container matColumnDef="parameter">
        <mat-header-cell *matHeaderCellDef mat-sort-header fxFlex="350px">Parameter</mat-header-cell>
        <mat-cell *matCellDef="let alarm" fxFlex="350px">
          <a [routerLink]="['/mdb/parameters/', alarm.triggerValue.id.name]"
             [queryParams]="{instance: instance.name}">
            {{ alarm.triggerValue.id.name }}
          </a>
        </mat-cell>
      </ng-container>

      <ng-container matColumnDef="spaceSystem">
        <mat-header-cell *matHeaderCellDef mat-sort-header fxFlex="150px">Space System</mat-header-cell>
        <mat-cell *matCellDef="let alarm" fxFlex="150px">
          <a [routerLink]="['/mdb/parameters/', alarm.triggerValue.id.name]"
              [queryParams]="{instance: instance.name}">
            {{ alarm.triggerValue.id.name }}
          </a>
        </mat-cell>
      </ng-container>

      <ng-container matColumnDef="time">
        <mat-header-cell *matHeaderCellDef mat-sort-header fxFlex="200px">Time</mat-header-cell>
        <mat-cell *matCellDef="let alarm" fxFlex="200px">{{ alarm.triggerValue.generationTimeUTC | datetime }}</mat-cell>
      </ng-container>

      <ng-container matColumnDef="currentValue">
        <mat-header-cell *matHeaderCellDef mat-sort-header fxFlex="150px">Current Value</mat-header-cell>
        <mat-cell *matCellDef="let alarm"
                  fxFlex="150px">
          <app-expirable [pval]="alarm.currentValue">
            <app-alarm-severity [severity]="alarm.currentValue.monitoringResult"></app-alarm-severity>
            &nbsp;{{ alarm.currentValue.engValue | value }}
          </app-expirable>
        </mat-cell>
      </ng-container>

      <ng-container matColumnDef="severity">
        <mat-header-cell *matHeaderCellDef mat-sort-header fxFlex="70px">Severity</mat-header-cell>
        <mat-cell *matCellDef="let alarm" fxFlex="70px">
          <app-alarm-severity [severity]="alarm.triggerValue.monitoringResult"></app-alarm-severity>
        </mat-cell>
      </ng-container>

      <ng-container matColumnDef="type">
        <mat-header-cell *matHeaderCellDef mat-sort-header fxFlex="150px">Alarm Type</mat-header-cell>
        <mat-cell *matCellDef="let alarm" fxFlex="150px">Out of Limits</mat-cell>
      </ng-container>

      <ng-container matColumnDef="value">
        <mat-header-cell *matHeaderCellDef mat-sort-header fxFlex="150px">Value</mat-header-cell>
        <mat-cell *matCellDef="let alarm" fxFlex="150px">{{ alarm.triggerValue.engValue | value }}</mat-cell>
      </ng-container>

      <ng-container matColumnDef="violations">
        <mat-header-cell *matHeaderCellDef mat-sort-header fxFlex="80px">Violations</mat-header-cell>
        <mat-cell *matCellDef="let alarm" style="text-align: right" fxFlex="80px">
          {{ alarm.violations | number }}
        </mat-cell>
      </ng-container>

      <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
      <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
    </mat-table>

    <ng-template #empty>
      <app-empty-message *ngIf="!(loading$ | async)">
        <mat-icon style="color: green">check_circle</mat-icon>
        All parameters normal.
      </app-empty-message>
    </ng-template>
  </div>
</app-monitor-page>
