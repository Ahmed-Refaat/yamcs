<app-instance-page *ngIf="command$ | async as command">
  <app-instance-toolbar>
    Send a command
  </app-instance-toolbar>

  <app-send-command-wizard-step step="2"></app-send-command-wizard-step>

  <div class="form-content">

    <dl class="dl-horizontal no-lead no-trail">
      <ng-container *ngFor="let alias of command.alias">
        <ng-container *ngIf="command.qualifiedName.startsWith(alias.namespace)">
          <dt>Command</dt>
          <dd>{{ alias.name }}</dd>

          <dt>Space system</dt>
          <dd>{{ alias.namespace }}</dd>
        </ng-container>
      </ng-container>

      <ng-container *ngFor="let alias of command.alias">
        <ng-container *ngIf="!command.qualifiedName.startsWith(alias.namespace)">
          <dt>{{ alias.namespace }}</dt>
          <dd>{{ alias.name }}</dd>
        </ng-container>
      </ng-container>

      <ng-container *ngIf="command.longDescription || command.shortDescription">
        <dt>Description</dt>
        <dd>{{ command.longDescription || command.shortDescription || '-' }}</dd>
      </ng-container>

      <dt>Significance</dt>
      <dd>
        <app-significance-level [significance]="command.significance"></app-significance-level>
        &nbsp;&nbsp;{{ command.significance?.reasonForWarning }}
      </dd>
    </dl>

    <p *ngIf="arguments.length || argumentsWithInitial.length">&nbsp;</p>
    <h3 *ngIf="arguments.length || argumentsWithInitial.length">Arguments</h3>
    <form [formGroup]="commandConfigurationForm"
          class="ya-form"
          [class.showAll]="showAll$ | async">
      <ng-container *ngFor="let argument of arguments; let first = first">
        <br *ngIf="!first">
        <ng-container [ngSwitch]="argument.type?.engType">

          <label *ngSwitchCase="'enumeration'">
            {{ argument.name }}
            <select [formControlName]="argument.name">
              <option *ngFor="let enumValue of argument.type.enumValue" [value]="enumValue.label">
                {{ enumValue.label }}</option>
            </select>
          </label>

          <label *ngSwitchCase="'boolean'">
            {{ argument.name }}<br>
            <input type="radio" [formControlName]="argument.name" value="true"> true
            <input type="radio" [formControlName]="argument.name" value="false"> false
          </label>

          <label *ngSwitchDefault>
            {{ argument.name }}
            <input type="text" [formControlName]="argument.name">
          </label>

        </ng-container>
      </ng-container>

      <ng-container *ngFor="let argument of argumentsWithInitial; let first = first">
        <br *ngIf="!first || arguments.length">
        <ng-container [ngSwitch]="argument.type?.engType">

          <label *ngSwitchCase="'enumeration'" class="hasInitial">
            {{ argument.name }}
            <select [formControlName]="argument.name">
              <option *ngFor="let enumValue of argument.type.enumValue" [value]="enumValue.label">
                {{ enumValue.label }}</option>
            </select>
          </label>

          <label *ngSwitchCase="'boolean'" class="hasInitial">
            {{ argument.name }}<br>
            <input type="radio" [formControlName]="argument.name" value="true"> true
            <input type="radio" [formControlName]="argument.name" value="false"> false
          </label>

          <label *ngSwitchDefault class="hasInitial">
            {{ argument.name }}
            <input type="text" [formControlName]="argument.name">
          </label>

        </ng-container>
      </ng-container>

      <app-text-action (click)="showAll$.next(true)"
                       *ngIf="argumentsWithInitial.length && !(showAll$ | async)"
                       icon="double_arrow">
        Show {{ argumentsWithInitial.length }}
        argument<ng-container *ngIf="argumentsWithInitial.length !== 1">s</ng-container> with defaults
      </app-text-action>

      <p>&nbsp;</p>
      <h3>Options</h3>
      <label>
        Comment <span class="hint">(optional)</span>
        <textarea formControlName="_comment" rows="3" style="width: 100%; resize: none"></textarea>
      </label>
    </form>
    <p>&nbsp;</p>
    <mat-toolbar>
      <button mat-button
              (click)="goBack()">
        Cancel
      </button>
      <span style="flex: 1 1 auto"></span>
      <mat-slide-toggle [formControl]="armControl">
        Arm
      </mat-slide-toggle>
      &nbsp;&nbsp;&nbsp;&nbsp;
      <button mat-raised-button color="primary"
              [disabled]="!armControl.value || !commandConfigurationForm.valid"
              (click)="sendCommand()">
        <mat-icon>send</mat-icon>
        Send
      </button>
    </mat-toolbar>
  </div>
</app-instance-page>
